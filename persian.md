توضیحات پروژه و وظایف
این ماژول به مدت ۷.۵ ساعت (تا ساعت ۱۶:۳۰) اجرا می‌شود – روز دوم: میکروسرویس‌ها در AWS EKS.
هدف این چالش، طراحی معماری یک وب‌اپلیکیشن عمومی (Public Client API) بر روی EKS است.

امروز باید یک وب‌اپلیکیشن با دسترسی بالا (High Availability)، قابلیت مقیاس‌پذیری (Scalable) و کارایی بالا (Efficient) را با استفاده از باینری Go ارائه‌شده، مستقر کنید. این باینری دارای وابستگی‌هایی به سرویس‌های مختلف است که در بخش «جزئیات فنی» ذکر شده‌اند. این اپلیکیشن در برابر کشینگ (Caching) و مقیاس‌پذیری افقی (Horizontal Scaling) عملکرد بسیار خوبی دارد.

این برنامه «به صورت آماده» قابل اجرا نیست. شما ۲ ساعت زمان دارید تا زیرساخت اولیه را راه‌اندازی کنید.
دو ساعت پس از شروع مسابقه، برنامه شما شروع به دریافت درخواست‌ها می‌کند. در صورتی که اپلیکیشن در این زمان در دسترس نباشد، امتیاز از دست خواهید داد.

در طول روز شما مسئول رسیدگی به تمام چالش‌هایی هستید که ممکن است ظاهر شوند. به عنوان یک معمار راه‌حل‌ها (Solutions Architect)، باید بتوانید با تغییر وظایف و ابهام‌ها به‌خوبی کنار بیایید.

پیش‌زمینه

عملکردهای اصلی سرویس Unicorn تنها در محیط EKS قابل اجرا هستند، اما برای تسهیل فرایند انتقال، می‌توانید آن را روی EC2 یا هر سیستم لینوکسی دیگر تست و اجرا کنید.
با این حال، اگر سرویس Unicorn را روی EC2 اجرا کرده و آدرس آن را به مشتری بدهید، در جریان بازی امتیاز از دست خواهید داد.

سرویس Unicorn در مسیر ریشه / یک Health Check دارد که در هر محیطی پاسخ HTTP 200 بدهد، یعنی اپلیکیشن شما به‌درستی کار می‌کند.

سیاست امنیتی شرکت Unicorn بسیار سخت‌گیرانه است و اجازه‌ی SSH از اینترنت به EC2 را نمی‌دهد. برای دسترسی به EC2 باید از سرویس‌های مناسب AWS استفاده کنید.

تیم امنیت شرکت چند Policy تعریف کرده که به شما امکان ساخت IAM Role‌های لازم برای استقرار سرویس Unicorn را می‌دهد، اما مستندی برای نحوه انجام این کار ارائه نکرده است. شما باید از طریق Team Role Policy کشف کنید که چه نقش‌هایی قابل ساخت هستند.
همچنین طبق قوانین امنیتی، اطلاعات دسترسی به پایگاه داده باید هر ۳۰ روز یک‌بار به‌صورت خودکار چرخش (Rotate) پیدا کند.

Policy‌های موجود:

UnicornPolicy → اجازه اجرای Unicorn Service روی EKS

AutoScalerPolicy → اجازه به EKS برای تنظیم خودکار تعداد نودها

ELBControllerPolicy → مورد نیاز برای AWS Load Balancer Controller

EFSPolicy → اجازه اتصال Unicorn Service به EFS

شما باید با توجه به سطح دسترسی خود تصمیم بگیرید که چگونه Roleها را ایجاد کنید.

تیم امنیت یک ابزار Third-Party SaaS برای بررسی وضعیت امنیتی EKS در آینده دارد. بنابراین باید مکانیزمی طراحی کنید که هم از Endpoint مربوط به Kubernetes API در برابر حملات محافظت کند، هم در آینده امکان دسترسی از اینترنت را بدهد.

نرم‌افزارهای مورد نیاز برای پشتیبانی از Unicorn Service

Amazon Web Services Load Balancer Controller

طبق بازخورد تیم UAT، استفاده از دو EC2 از نوع t3.medium برای ترافیک عادی کافی است. استفاده از انواع بزرگ‌تر باعث افزایش هزینه غیرضروری می‌شود.
با این حال باید با استفاده از CloudWatch ترافیک را مانیتور کرده و در صورت افزایش غیرمنتظره، ظرفیت را تنظیم کنید تا سرویس در دسترس بماند.

وضعیت اولیه

در ابتدای رقابت، یک EC2 در حساب شما در حال اجرا است. سرویس Unicorn در این مرحله غیرفعال است و هنوز درخواستی دریافت نمی‌کند. درخواست‌ها دقیقاً دو ساعت پس از شروع رقابت ارسال خواهند شد.

⚠️ هشدار:
به هیچ وجه این EC2 پیش‌فرض را حذف (Terminate) نکنید. در صورت حذف، طبق پروتکل امنیتی شرکت Unicorn دیگر نمی‌توانید EC2 جدید بسازید.
این EC2 به عنوان Bastion Server عمل می‌کند و داوران باید بتوانند به آن وارد شوند و سیستم شما را بررسی کنند.
اگر ابزاری روی آن نصب کردید، مسیر نصب را به متغیر PATH اضافه کنید.
(یک Instance Profile با نامی مشابه TeamRoleInstanceProfile برای شما آماده است.)

برنامه استقرار مجدد (Re-platform Schedule)
Phase I

ساخت زیرساخت پایه‌ای با قابلیت دسترسی بالا و مقاومت (Resilient)

سرویس‌های مورد توجه: VPC، Security Group و غیره

Phase II

ساخت سرویس Unicorn

سرویس‌های مورد توجه: ECR، EKS، IAM، RDS و غیره

Phase III

ارائه سرویس Unicorn از طریق Endpoint عمومی به داشبورد GameDay

فهرست وظایف

ورود به GameDay با Hash اختصاصی خود

تنظیم نام تیم/رقیب در داشبورد

مطالعه کامل مستندات

ورود به AWS Console از طریق لینک موجود در داشبورد

بررسی سطح دسترسی خود پیش از انتخاب ابزارها

بررسی پیکربندی‌های فعلی در EC2

بررسی پیکربندی‌های فعلی در VPC

ایجاد EKS Cluster از طریق AWS Console (دو Role با نام‌های EKSClusterRole و EKSNodeRole از قبل ایجاد شده‌اند)

استقرار اپلیکیشن در EKS برای مدیریت بار کاری زیاد

پیکربندی وابستگی‌های سرور طبق بخش جزئیات فنی

مانیتور عملکرد سرورها از طریق CloudWatch و داشبورد امتیازات

پاسخ‌دهی به درخواست‌های کاربران برای کسب امتیاز

پردازش خطاها هنگام دریافت آن‌ها

این بخش از پروژه آزمایشی به مدت ۷.۵ ساعت ادامه دارد.

جزئیات فنی

اپلیکیشن سرور به صورت باینری Go کامپایل شده است. تغییر دادن باینری منجر به حذف از مسابقه می‌شود.

تنها از EKS استفاده کنید، ECS یا Fargate ممنوع است.

این اپلیکیشن بیش از ۵ اتصال همزمان را به سختی مدیریت می‌کند. به خطای HTTP 503 توجه داشته باشید.

باینری برنامه از نوع x86 استاتیک و unstripped است. نسخه‌های root و stub در فایل Readme موجودند.

نیازمندی‌ها:

مجوز گوش دادن روی پورت TCP تعریف‌شده (پیش‌فرض ۸۰)

دسترسی به فایل پیکربندی از AWS AppConfig

دسترسی به Redis (ElasticCache)

دسترسی به MySQL (RDS) با جدول مشخص‌شده

دسترسی به فضای ذخیره‌سازی برای کش فایل‌ها (EFS)

سرویس به Redis، MySQL و EFS متصل می‌شود. استفاده از نسخه‌های محلی در هر Instance ممکن است ولی غیربهینه است.
هرچه زیرساخت بهینه‌تر باشد، پاسخ‌ها سریع‌تر و امتیازتان بیشتر است.

سیستم‌عامل پایه Amazon Linux است.

AWS CLI روی Amazon Linux نصب شده و می‌توانید از آن استفاده کنید.

جزئیات سرویس‌ها
مروری کلی

هر درخواست جدید به سرور نیاز به تولید پاسخ دارد (کند). اما پس از تولید پاسخ، داده‌ی آن در Redis، MySQL و فایل ذخیره می‌شود.
اگر همان درخواست دوباره ارسال شود، پاسخ از کش برمی‌گردد.

در صورتی که از راه‌حل متمرکز (Centralized) برای Redis و MySQL استفاده کنید، هر نودی در کلاستر قادر است پاسخ را ارائه دهد.
اما در صورت نصب Redis/MySQL روی هر Instance به صورت جداگانه، داده‌ها بین نودها به‌اشتراک گذاشته نمی‌شوند و هر نود باید پاسخ جدید بسازد.

AppConfig

سرویس Unicorn از AWS AppConfig برای مدیریت پیکربندی استفاده می‌کند.

MySQL (RDS)

باید یک RDS MySQL با در دسترس‌پذیری بالا بسازید.
نام دیتابیس باید unicorndb باشد و جدول زیر را ایجاد کنید:

CREATE TABLE unicorns (
  unicornid varchar(256),
  unicornlocation varchar(256)
);


نام جدول unicorns است و نمی‌توان آن را تغییر داد.

Redis (ElasticCache)

Redis باید به‌صورت متمرکز مستقر شود. از دو Instance t3.medium بیشتر استفاده نکنید. Redis Cluster پشتیبانی نمی‌شود.

File Storage

ذخیره‌سازی فایل مرکزی الزامی نیست، ولی سرعت پاسخ را بهبود می‌دهد.
می‌توانید از EFS استفاده کنید یا مسیر محلی برای کش:

"FsPath" = "/path/to/files/"
